var v=Object.defineProperty;var A=(p,e,i)=>e in p?v(p,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):p[e]=i;var d=(p,e,i)=>A(p,typeof e!="symbol"?e+"":e,i);import{j as o,k as y,s as M,g as w}from"./index-CspSaxt6.js";function E(p){C();const e=document.createElement("div");e.className="fixed left-0 top-0 w-screen h-screen flex items-center justify-center z-[9999] bg-black/70 pointer-events-auto",e.style.backdropFilter="blur(2px)",e.style.transition="opacity 0.3s",e.id="connect4-loading-overlay";const i=document.createElement("div");i.className="flex flex-col items-center",i.innerHTML=`
    <div class="relative flex items-center justify-center">
      <svg class="animate-spin drop-shadow-neon-cyan" style="animation-duration:1.2s;" width="110" height="110" viewBox="0 0 110 110">
        <defs>
          <radialGradient id="neonGlow" cx="50%" cy="50%" r="50%">
            <stop offset="0%" stop-color="#00fff7" stop-opacity="0.7"/>
            <stop offset="100%" stop-color="#00fff7" stop-opacity="0"/>
          </radialGradient>
        </defs>
        <circle cx="55" cy="55" r="44" stroke="#00fff7" stroke-width="8" fill="none" opacity="0.18"/>
        <circle cx="55" cy="55" r="44" stroke="#00fff7" stroke-width="8" fill="none" stroke-linecap="round" stroke-dasharray="70 200" filter="url(#glow)"/>
        <circle cx="55" cy="55" r="44" fill="url(#neonGlow)"/>
      </svg>
      <div class="absolute w-[140px] h-[140px] rounded-full pointer-events-none" style="box-shadow:0 0 60px 20px #00fff7,0 0 120px 40px #00fff7AA;"></div>
    </div>
    <div class="mt-8 text-neon-cyan font-cyber text-3xl animate-glow-pulse drop-shadow-neon-cyan text-center select-none">
      Building the Connect4 board...
    </div>
  `,e.appendChild(i),document.body.appendChild(e)}function C(p){const e=document.getElementById("connect4-loading-overlay");e&&e.remove()}class P{constructor(e,i,t){d(this,"multiplayerCallbacks",{});d(this,"canvas");d(this,"engine");d(this,"scene");d(this,"camera");d(this,"container");d(this,"gui");d(this,"ROWS",6);d(this,"COLS",7);d(this,"EMPTY",0);d(this,"PLAYER1",1);d(this,"PLAYER2",2);d(this,"board");d(this,"discs");d(this,"columnDetectors",[]);d(this,"currentPlayer",this.PLAYER1);d(this,"gameEnded",!1);d(this,"player1Name");d(this,"player2Name");d(this,"currentPlayerText");d(this,"gameStatusText");d(this,"onGameEnd");d(this,"isAnimating",!1);d(this,"isTournamentMode",!1);d(this,"aiType");d(this,"isAiGame",!1);d(this,"aiMoveTimeout");d(this,"transpositionTable",new Map);this.player1Name=e,this.player2Name=i,this.onGameEnd=t==null?void 0:t.onGameEnd,this.isTournamentMode=(t==null?void 0:t.isTournamentMode)||!1,t!=null&&t.aiType?(this.aiType=t.aiType,this.isAiGame=!0,console.log("AI game configured with type:",this.aiType)):console.log("No AI configured, human vs human game"),this.board=Array(this.ROWS).fill(null).map(()=>Array(this.COLS).fill(this.EMPTY)),this.discs=Array(this.ROWS).fill(null).map(()=>Array(this.COLS).fill(null)),this.container=document.createElement("div"),this.container.className="connect4-container relative",this.container.style.width="800px",this.container.style.height="600px",this.canvas=document.createElement("canvas"),this.canvas.width=800,this.canvas.height=600,this.canvas.className="rounded-lg shadow-lg",this.container.appendChild(this.canvas),E(this.container),this.engine=new o.Engine(this.canvas,!0),this.scene=new o.Scene(this.engine),this.setupScene(),setTimeout(()=>{this.createBoard(),this.setupGUI(),this.setupClickHandlers(),C(this.container),this.startRenderLoop(),this.initializeGame()},50)}setMultiplayerCallbacks(e){this.multiplayerCallbacks=e}updateGameState(e,i){this.board=e.map(t=>[...t]),this.currentPlayer=i,this.gameEnded=!1,this.refreshBoardDisplay()}refreshBoardDisplay(){var e;for(let i=0;i<this.ROWS;i++)for(let t=0;t<this.COLS;t++)this.discs[i][t]&&((e=this.discs[i][t])==null||e.dispose(),this.discs[i][t]=null);for(let i=0;i<this.ROWS;i++)for(let t=0;t<this.COLS;t++)(this.board[i][t]===this.PLAYER1||this.board[i][t]===this.PLAYER2)&&this.createDiscAt(i,t,this.board[i][t])}createDiscAt(e,i,t){const s=o.MeshBuilder.CreateCylinder(`disc_${e}_${i}_${t}_${Date.now()}`,{diameter:1,height:.3,tessellation:32},this.scene);s.rotation.x=Math.PI/2;const n=new o.StandardMaterial(`discMaterial_${e}_${i}_${t}`,this.scene);t===this.PLAYER1?(n.diffuseColor=new o.Color3(.8,.2,.2),n.emissiveColor=new o.Color3(.3,0,0),n.specularColor=new o.Color3(.5,.1,.1)):(n.diffuseColor=new o.Color3(.1,.5,1),n.emissiveColor=new o.Color3(0,.3,1),n.specularColor=new o.Color3(.2,.7,1)),s.material=n;const a=this.ROWS*1.2+3,c=(this.ROWS-1-e)*1.2;s.position=new o.Vector3(i*1.2,a,0);const r=new o.Animation("discFall","position.y",30,o.Animation.ANIMATIONTYPE_FLOAT,o.Animation.ANIMATIONLOOPMODE_CONSTANT),h=[];h.push({frame:0,value:a}),h.push({frame:30,value:c}),r.setKeys(h);const l=new o.BounceEase;l.setEasingMode(o.EasingFunction.EASINGMODE_EASEOUT),r.setEasingFunction(l),s.animations=[r],this.scene.beginAnimation(s,0,30,!1,1,()=>{s.position.x=i*1.2,s.position.y=c,s.position.z=0}),this.discs[e][i]=s}setupScene(){this.camera=new o.ArcRotateCamera("camera",Math.PI/2,Math.PI/3,25,new o.Vector3((this.COLS-1)*1.2/2,(this.ROWS-1)*1.2/2,0),this.scene),this.camera.attachControl(this.canvas,!0),this.camera.setTarget(new o.Vector3((this.COLS-1)*1.2/2,(this.ROWS-1)*1.2/2,0)),this.canvas.addEventListener("wheel",n=>{n.preventDefault(),n.stopPropagation()},{passive:!1});try{this.scene.enablePhysics(new o.Vector3(0,-9.81,0),new o.CannonJSPlugin)}catch{console.warn("Physics engine not available, using animation fallback")}const e=new o.HemisphericLight("light",new o.Vector3(0,1,0),this.scene);e.intensity=.4;const i=new o.DirectionalLight("dirLight",new o.Vector3(-1,-1,1),this.scene);i.position=new o.Vector3(10,10,-10),i.intensity=.3;const t=new o.PointLight("neonLight1",new o.Vector3(-2,this.ROWS*1.2+2,3),this.scene);t.diffuse=new o.Color3(0,1,1),t.intensity=.8;const s=new o.PointLight("neonLight2",new o.Vector3(this.COLS*1.2+2,-2,3),this.scene);s.diffuse=new o.Color3(0,1,1),s.intensity=.8,this.scene.clearColor=new o.Color4(.05,.05,.1,1)}createBoard(){this.createConnect4Board(),this.createNeonLights();for(let e=0;e<this.COLS;e++){const i=o.MeshBuilder.CreateBox(`detector_${e}`,{width:1.2,height:this.ROWS*1.2+2,depth:1},this.scene);i.position=new o.Vector3(e*1.2,(this.ROWS-1)*1.2/2,0),i.visibility=0,i.metadata={column:e},this.columnDetectors.push(i)}}createConnect4Board(){const i=(this.COLS-1)*1.2+2,t=(this.ROWS-1)*1.2+1.4,s=new o.StandardMaterial("boardMat",this.scene);s.diffuseColor=new o.Color3(.05,.08,.18),s.specularColor=new o.Color3(.2,.8,1),s.emissiveColor=new o.Color3(0,.2,.5),s.alpha=.98,s.reflectionFresnelParameters=new o.FresnelParameters,s.reflectionFresnelParameters.bias=.2,s.reflectionFresnelParameters.power=2;const n=1.1,a=o.MeshBuilder.CreateBox("baseBoardCSG",{width:i,height:t,depth:.8},this.scene);a.position=o.Vector3.Zero();let c=o.CSG.FromMesh(a);a.dispose();for(let h=0;h<this.ROWS;h++)for(let l=0;l<this.COLS;l++){const m=l*1.2-i/2+1,u=(this.ROWS-1-h)*1.2-t/2+.7,f=o.MeshBuilder.CreateCylinder(`csgHole_${h}_${l}`,{diameter:n,height:.8+.2},this.scene);f.rotation.x=Math.PI/2,f.position=new o.Vector3(m,u,0);const g=o.CSG.FromMesh(f);c=c.subtract(g),f.dispose()}const r=c.toMesh("finalBoard",null,this.scene);r.material=s,r.position=new o.Vector3((this.COLS-1)*1.2/2,(this.ROWS-1)*1.2/2,0)}createNeonLights(){const e=new o.StandardMaterial("neonMaterial",this.scene);e.diffuseColor=new o.Color3(0,1,1),e.emissiveColor=new o.Color3(0,2,2),e.specularColor=new o.Color3(.5,1,1),e.alpha=.95,e.reflectionFresnelParameters=new o.FresnelParameters,e.reflectionFresnelParameters.bias=.4,e.reflectionFresnelParameters.power=3,e.emissiveFresnelParameters=new o.FresnelParameters,e.emissiveFresnelParameters.bias=.6,e.emissiveFresnelParameters.power=2;const i=.8,t=(this.COLS-1)*1.2,s=(this.ROWS-1)*1.2,n=1+i/2,a=o.MeshBuilder.CreateCylinder("topNeon",{height:t+1.2,diameter:.22},this.scene);a.rotation.z=Math.PI/2,a.position=new o.Vector3(t/2,s/2+s/2+n,0),a.material=e;const c=o.MeshBuilder.CreateCylinder("bottomNeon",{height:t+1.2,diameter:.22},this.scene);c.rotation.z=Math.PI/2,c.position=new o.Vector3(t/2,-1.4,0),c.material=e;const r=o.MeshBuilder.CreateCylinder("leftNeon",{height:s+1.2,diameter:.22},this.scene);r.position=new o.Vector3(-1.4,s/2,0),r.material=e;const h=o.MeshBuilder.CreateCylinder("rightNeon",{height:s+1.2,diameter:.22},this.scene);h.position=new o.Vector3(t+n,s/2,0),h.material=e,[[-1.4,s+n,0],[t+n,s+n,0],[-1.4,-1.4,0],[t+n,-1.4,0]].forEach((f,g)=>{const b=o.MeshBuilder.CreateSphere(`cornerNeon_${g}`,{diameter:.5},this.scene);b.position=new o.Vector3(f[0],f[1],f[2]),b.material=e});const m=new o.Animation("neonPulse","material.emissiveColor",30,o.Animation.ANIMATIONTYPE_COLOR3,o.Animation.ANIMATIONLOOPMODE_CYCLE),u=[];u.push({frame:0,value:new o.Color3(0,1.5,2)}),u.push({frame:15,value:new o.Color3(0,2,1.2)}),u.push({frame:30,value:new o.Color3(0,1.5,2)}),m.setKeys(u),[a,c,r,h].forEach(f=>{f.animations=[m],this.scene.beginAnimation(f,0,30,!0)})}setupGUI(){this.gui=y.AdvancedDynamicTexture.CreateFullscreenUI("UI"),this.currentPlayerText=new y.TextBlock,this.currentPlayerText.text=`${this.player1Name}'s Turn`,this.currentPlayerText.color="#ff4466",this.currentPlayerText.fontSize=24,this.currentPlayerText.fontFamily="Arial",this.currentPlayerText.top="-250px",this.currentPlayerText.height="30px",this.gui.addControl(this.currentPlayerText),this.gameStatusText=new y.TextBlock,this.gameStatusText.text="Click on a column to drop your disc!",this.gameStatusText.color="#ffffff",this.gameStatusText.fontSize=18,this.gameStatusText.fontFamily="Arial",this.gameStatusText.top="-220px",this.gameStatusText.height="25px",this.gui.addControl(this.gameStatusText)}setupClickHandlers(){this.scene.onPointerObservable.add(e=>{var i,t;if((i=e.pickInfo)!=null&&i.hit&&!this.isAnimating&&!this.gameEnded){const s=e.pickInfo.pickedMesh;if(s&&((t=s.metadata)==null?void 0:t.column)!==void 0){if(this.isAiGame&&this.currentPlayer===this.PLAYER2)return;const n=s.metadata.column;this.multiplayerCallbacks.onMove?this.multiplayerCallbacks.onMove(n):this.dropDisc(n)}}})}dropDisc(e){if(this.gameEnded||this.isAnimating)return;let i=-1;for(let l=this.ROWS-1;l>=0;l--)if(this.board[l][e]===this.EMPTY){i=l;break}if(i===-1){M("Column is full!","error");return}this.isAnimating=!0,this.board[i][e]=this.currentPlayer;const t=o.MeshBuilder.CreateCylinder(`disc_${i}_${e}`,{diameter:1,height:.3,tessellation:32},this.scene);t.rotation.x=Math.PI/2;const s=new o.StandardMaterial(`discMaterial_${i}_${e}`,this.scene);this.currentPlayer===this.PLAYER1?(s.diffuseColor=new o.Color3(.8,.2,.2),s.emissiveColor=new o.Color3(.3,0,0),s.specularColor=new o.Color3(.5,.1,.1)):(s.diffuseColor=new o.Color3(.1,.5,1),s.emissiveColor=new o.Color3(0,.3,1),s.specularColor=new o.Color3(.2,.7,1)),t.material=s;const n=this.ROWS*1.2+3,a=(this.ROWS-1-i)*1.2;t.position=new o.Vector3(e*1.2,n,0);const c=new o.Animation("discFall","position.y",30,o.Animation.ANIMATIONTYPE_FLOAT,o.Animation.ANIMATIONLOOPMODE_CONSTANT),r=[];r.push({frame:0,value:n}),r.push({frame:30,value:a}),c.setKeys(r);const h=new o.BounceEase;h.setEasingMode(o.EasingFunction.EASINGMODE_EASEOUT),c.setEasingFunction(h),t.animations=[c],this.scene.beginAnimation(t,0,30,!1,1,()=>{t.position.x=e*1.2,t.position.y=a,t.position.z=0,this.discs[i][e]=t,setTimeout(()=>{this.checkGameState(i,e)},500)})}addSingleDisc(e,i,t){this.discs[e]&&this.discs[e][i]||(this.board[e][i]=t,this.createDiscAt(e,i,t),this.updateUI())}checkGameState(e,i){this.isAnimating=!1,this.checkWin(e,i)?this.endGame(this.currentPlayer===this.PLAYER1?this.player1Name:this.player2Name):this.isBoardFull()?this.endGame("Draw"):(this.currentPlayer=this.currentPlayer===this.PLAYER1?this.PLAYER2:this.PLAYER1,this.updateUI(),console.log("Switched to player:",this.currentPlayer,"isAiGame:",this.isAiGame),this.isAiGame&&this.currentPlayer===this.PLAYER2&&(console.log("AI turn detected, making move..."),this.makeAiMove()))}checkWin(e,i){const t=this.board[e][i];let s=1;for(let n=i-1;n>=0&&this.board[e][n]===t;n--)s++;for(let n=i+1;n<this.COLS&&this.board[e][n]===t;n++)s++;if(s>=4)return!0;s=1;for(let n=e+1;n<this.ROWS&&this.board[n][i]===t;n++)s++;if(s>=4)return!0;s=1;for(let n=e-1,a=i-1;n>=0&&a>=0&&this.board[n][a]===t;n--,a--)s++;for(let n=e+1,a=i+1;n<this.ROWS&&a<this.COLS&&this.board[n][a]===t;n++,a++)s++;if(s>=4)return!0;s=1;for(let n=e-1,a=i+1;n>=0&&a<this.COLS&&this.board[n][a]===t;n--,a++)s++;for(let n=e+1,a=i-1;n<this.ROWS&&a>=0&&this.board[n][a]===t;n++,a--)s++;return s>=4}isBoardFull(){for(let e=0;e<this.COLS;e++)if(this.board[0][e]===this.EMPTY)return!1;return!0}updateUI(){this.currentPlayer===this.PLAYER1?(this.currentPlayerText.text=`${this.player1Name}'s Turn`,this.currentPlayerText.color="#ff4466"):(this.currentPlayerText.text=`${this.player2Name}'s Turn`,this.currentPlayerText.color="#ffcc00")}endGame(e){this.gameEnded=!0,this.isTournamentMode?this.showTournamentComplete(e):this.showNormalGameEnd(e),this.onGameEnd&&this.onGameEnd(e)}showTournamentComplete(e){const i=this.container.querySelector(".connect4-container");i&&(i.style.display="none");const t=w("flex flex-col items-center justify-center gap-8 max-w-3xl mx-auto"),s=document.createElement("div");s.className="text-center mb-8";const n=document.createElement("h2");n.className="text-5xl font-cyber text-neon-pink animate-glow-pulse mb-4 tracking-wider",n.textContent="TOURNAMENT COMPLETE";const a=document.createElement("p");a.className="text-xl font-tech text-neon-cyan mb-2",a.textContent=e==="Draw"?"Match ended in a draw!":"Congratulations to our champion!";const c=document.createElement("div");c.className="h-1 w-32 bg-gradient-to-r from-neon-pink to-neon-cyan mx-auto",s.appendChild(n),s.appendChild(a),s.appendChild(c);const r=document.createElement("div");r.className="bg-cyber-darker/90 backdrop-blur-md p-12 rounded-lg border-2 border-neon-pink/60 shadow-lg shadow-neon-pink/30 w-full text-center";const h=document.createElement("div");h.className="text-8xl mb-6",h.textContent=e==="Draw"?"ðŸ¤":"ðŸ†";const l=document.createElement("p");l.className="text-lg font-tech text-gray-300 mb-4",l.textContent=e==="Draw"?"MATCH RESULT":"TOURNAMENT WINNER";const m=document.createElement("p");m.className="text-4xl font-cyber text-neon-pink bg-cyber-dark/50 px-8 py-6 rounded border-2 border-neon-pink/40 shadow-lg mb-6",m.textContent=e==="Draw"?"DRAW":e||"Unknown";const u=document.createElement("p");u.className="text-xl font-tech text-neon-cyan",u.textContent=e==="Draw"?"An excellent match from both players!":"Victory achieved through skill and determination!",r.appendChild(h),r.appendChild(l),r.appendChild(m),r.appendChild(u);const f=document.createElement("div");f.className="flex gap-4 mt-8";const g=document.createElement("button");g.className="bg-gradient-to-r from-neon-cyan to-neon-pink text-white font-cyber px-8 py-4 rounded-lg text-xl hover:shadow-lg hover:shadow-neon-cyan/50 transition-all duration-300",g.textContent="PLAY AGAIN",g.addEventListener("click",()=>{this.container.innerHTML="",this.container.appendChild(this.canvas),this.resetGame(),i&&(i.style.display="block")});const b=document.createElement("button");b.className="bg-gradient-to-r from-neon-pink to-red-500 text-white font-cyber px-8 py-4 rounded-lg text-xl hover:shadow-lg hover:shadow-red-500/50 transition-all duration-300",b.textContent="RETURN TO DASHBOARD",b.addEventListener("click",()=>{window.location.href="/dashboard"}),f.appendChild(g),f.appendChild(b),t.appendChild(s),t.appendChild(r),t.appendChild(f),this.container.innerHTML="",this.container.appendChild(t)}showNormalGameEnd(e){const i=document.createElement("div");i.className="absolute inset-0 bg-black/80 flex items-center justify-center z-50 animate-fade-in";const t=document.createElement("div");t.className="bg-cyber-dark border-2 border-neon-cyan p-8 text-center cyber-border animate-scale-in max-w-md mx-4";const s=document.createElement("h2");s.className="text-neon-cyan font-cyber text-4xl mb-2 animate-glow-pulse",s.textContent=e==="Draw"?"DRAW":"GAME OVER";const n=document.createElement("p");n.className="text-neon-cyan font-cyber text-2xl mb-6",n.textContent=e==="Draw"?"It's a draw!":`${e} WINS!`;const a=document.createElement("div");a.className="flex flex-col gap-4 mt-6";const c=document.createElement("button");c.textContent="REPLAY",c.className="bg-neon-cyan text-black font-cyber px-6 py-3 rounded shadow-lg hover:bg-cyan-400 transition",c.onclick=()=>{i.remove(),this.resetGame()};const r=document.createElement("button");r.textContent="BACK",r.className="bg-neon-pink text-white font-cyber px-6 py-3 rounded shadow-lg hover:bg-pink-500 transition",r.onclick=()=>{i.remove(),window.history.back()},a.appendChild(c),a.appendChild(r),t.appendChild(s),t.appendChild(n),t.appendChild(a),i.appendChild(t),this.container.appendChild(i)}startRenderLoop(){this.engine.runRenderLoop(()=>{this.scene.render()}),window.addEventListener("resize",()=>{this.engine.resize()})}resetGame(){var e;this.aiMoveTimeout&&(clearTimeout(this.aiMoveTimeout),this.aiMoveTimeout=void 0),this.aiType==="nightmare"&&this.transpositionTable.clear(),this.board=Array(this.ROWS).fill(null).map(()=>Array(this.COLS).fill(this.EMPTY)),this.gameEnded=!1;for(let i=0;i<this.ROWS;i++)for(let t=0;t<this.COLS;t++)this.discs[i][t]&&((e=this.discs[i][t])==null||e.dispose(),this.discs[i][t]=null);this.gameStatusText.text="Click on a column to drop your disc!",this.initializeGame()}render(){return this.container}destroy(){this.aiMoveTimeout&&(clearTimeout(this.aiMoveTimeout),this.aiMoveTimeout=void 0),this.engine&&this.engine.dispose(),this.container&&this.container.parentNode&&this.container.parentNode.removeChild(this.container)}initializeGame(){console.log("initializeGame called - isAiGame:",this.isAiGame,"currentPlayer:",this.currentPlayer),this.isAiGame&&Math.random()<.5?(this.currentPlayer=this.PLAYER2,this.updateUI(),console.log("AI will start first"),setTimeout(()=>{this.makeAiMove()},1e3)):(this.currentPlayer=this.PLAYER1,this.updateUI(),console.log("Human starts first"))}makeAiMove(){if(console.log("makeAiMove called - isAiGame:",this.isAiGame,"gameEnded:",this.gameEnded,"isAnimating:",this.isAnimating),!this.isAiGame||this.gameEnded||this.isAnimating)return;const e=this.getAiDelay();console.log("AI will move in",e,"ms"),this.aiMoveTimeout=window.setTimeout(()=>{const i=this.getAiMove();console.log("AI chose column:",i),i!==-1?this.dropDisc(i):console.error("AI returned invalid column")},e)}getAiDelay(){switch(this.aiType){case"easy":return 800+Math.random()*1200;case"medium":return 600+Math.random()*800;case"hard":return 400+Math.random()*600;case"nightmare":return 100+Math.random()*200;default:return 1e3}}getAiMove(){switch(console.log("getAiMove called with aiType:",this.aiType),this.aiType){case"easy":return this.getEasyAiMove();case"medium":return this.getMediumAiMove();case"hard":return this.getHardAiMove();case"nightmare":return this.getNightmareAiMove();default:return console.warn("Unknown AI type, using random move"),this.getRandomMove()}}getEasyAiMove(){return Math.random()<.7?this.getRandomMove():this.getMediumAiMove()}getMediumAiMove(){let e=this.findWinningMove(this.PLAYER2);return e!==-1||(e=this.findWinningMove(this.PLAYER1),e!==-1)?e:this.getRandomMove()}getHardAiMove(){return this.minimax(3,this.PLAYER2,-1/0,1/0).column}getNightmareAiMove(){if(this.isEarlyGame()){const i=this.getOptimalOpening();if(i!==-1)return i}const e=Math.min(10,this.getEmptySpaces());return this.minimax(e,this.PLAYER2,-1/0,1/0).column}getRandomMove(){const e=this.getValidMoves();if(console.log("Valid moves available:",e),e.length===0)return-1;const i=e[Math.floor(Math.random()*e.length)];return console.log("Random move selected:",i),i}getValidMoves(){const e=[];for(let i=0;i<this.COLS;i++)this.board[0][i]===this.EMPTY&&e.push(i);return e}findWinningMove(e){for(let i=0;i<this.COLS;i++)if(this.board[0][i]===this.EMPTY){let t=-1;for(let s=this.ROWS-1;s>=0;s--)if(this.board[s][i]===this.EMPTY){t=s;break}if(t!==-1){this.board[t][i]=e;const s=this.checkWin(t,i);if(this.board[t][i]=this.EMPTY,s)return i}}return-1}minimax(e,i,t,s){const n=this.getValidMoves(),a=this.aiType==="nightmare"?this.getBoardKey():"";if(this.aiType==="nightmare"&&a){const r=this.transpositionTable.get(a);if(r&&r.depth>=e)return{column:r.bestMove,score:r.score}}if(e===0||n.length===0)return{column:-1,score:this.aiType==="nightmare"?this.evaluateBoardAdvanced():this.evaluateBoard()};let c=n[0];if(i===this.PLAYER2){let r=-1/0;for(const h of n){const l=this.getNextRow(h);if(l!==-1){if(this.board[l][h]=i,this.checkWin(l,h)){this.board[l][h]=this.EMPTY;const u={column:h,score:1e6+e};return this.aiType==="nightmare"&&a&&this.transpositionTable.set(a,{score:u.score,depth:e,bestMove:h}),u}const m=this.minimax(e-1,this.PLAYER1,t,s).score;if(this.board[l][h]=this.EMPTY,m>r&&(r=m,c=h),t=Math.max(t,m),s<=t)break}}return this.aiType==="nightmare"&&a&&this.transpositionTable.set(a,{score:r,depth:e,bestMove:c}),{column:c,score:r}}else{let r=1/0;for(const h of n){const l=this.getNextRow(h);if(l!==-1){if(this.board[l][h]=i,this.checkWin(l,h)){this.board[l][h]=this.EMPTY;const u={column:h,score:-1e6-e};return this.aiType==="nightmare"&&a&&this.transpositionTable.set(a,{score:u.score,depth:e,bestMove:h}),u}const m=this.minimax(e-1,this.PLAYER2,t,s).score;if(this.board[l][h]=this.EMPTY,m<r&&(r=m,c=h),s=Math.min(s,m),s<=t)break}}return this.aiType==="nightmare"&&a&&this.transpositionTable.set(a,{score:r,depth:e,bestMove:c}),{column:c,score:r}}}getNextRow(e){for(let i=this.ROWS-1;i>=0;i--)if(this.board[i][e]===this.EMPTY)return i;return-1}evaluateBoard(){let e=0;for(let i=0;i<this.ROWS;i++)for(let t=0;t<this.COLS;t++)t<=this.COLS-4&&(e+=this.evaluateWindowAdvanced([this.board[i][t],this.board[i][t+1],this.board[i][t+2],this.board[i][t+3]])),i<=this.ROWS-4&&(e+=this.evaluateWindowAdvanced([this.board[i][t],this.board[i+1][t],this.board[i+2][t],this.board[i+3][t]])),i<=this.ROWS-4&&t<=this.COLS-4&&(e+=this.evaluateWindowAdvanced([this.board[i][t],this.board[i+1][t+1],this.board[i+2][t+2],this.board[i+3][t+3]])),i<=this.ROWS-4&&t>=3&&(e+=this.evaluateWindowAdvanced([this.board[i][t],this.board[i+1][t-1],this.board[i+2][t-2],this.board[i+3][t-3]]));return e}isEarlyGame(){return this.getTotalMoves()<6}getTotalMoves(){let e=0;for(let i=0;i<this.ROWS;i++)for(let t=0;t<this.COLS;t++)this.board[i][t]!==this.EMPTY&&e++;return e}getEmptySpaces(){return this.ROWS*this.COLS-this.getTotalMoves()}getOptimalOpening(){const e=this.getTotalMoves(),i=Math.floor(this.COLS/2);return e===0?i:e===1?this.board[this.ROWS-1][i]===this.PLAYER1?i-1:i:e===2&&this.board[this.ROWS-1][i]===this.PLAYER2?i+1:-1}evaluateBoardAdvanced(){let e=0;for(let t=0;t<this.COLS;t++)if(this.board[0][t]===this.EMPTY){const s=this.getNextRow(t);if(s!==-1){if(this.board[s][t]=this.PLAYER2,this.checkWin(s,t))return this.board[s][t]=this.EMPTY,1e4;this.board[s][t]=this.EMPTY,this.board[s][t]=this.PLAYER1,this.checkWin(s,t)&&(this.board[s][t]=this.EMPTY,e+=5e3),this.board[s][t]=this.EMPTY}}const i=Math.floor(this.COLS/2);for(let t=0;t<this.ROWS;t++)this.board[t][i]===this.PLAYER2&&(e+=10),this.board[t][i]===this.PLAYER1&&(e-=8),i>0&&(this.board[t][i-1]===this.PLAYER2&&(e+=6),this.board[t][i-1]===this.PLAYER1&&(e-=5)),i<this.COLS-1&&(this.board[t][i+1]===this.PLAYER2&&(e+=6),this.board[t][i+1]===this.PLAYER1&&(e-=5));e+=this.evaluateAdvancedPatterns();for(let t=0;t<this.ROWS;t++)for(let s=0;s<this.COLS;s++)s<=this.COLS-4&&(e+=this.evaluateWindowAdvanced([this.board[t][s],this.board[t][s+1],this.board[t][s+2],this.board[t][s+3]])),t<=this.ROWS-4&&(e+=this.evaluateWindowAdvanced([this.board[t][s],this.board[t+1][s],this.board[t+2][s],this.board[t+3][s]])),t<=this.ROWS-4&&s<=this.COLS-4&&(e+=this.evaluateWindowAdvanced([this.board[t][s],this.board[t+1][s+1],this.board[t+2][s+2],this.board[t+3][s+3]])),t<=this.ROWS-4&&s>=3&&(e+=this.evaluateWindowAdvanced([this.board[t][s],this.board[t+1][s-1],this.board[t+2][s-2],this.board[t+3][s-3]]));return e}evaluateAdvancedPatterns(){let e=0,i=0,t=0;for(let s=0;s<this.COLS;s++)if(this.board[0][s]===this.EMPTY){const n=this.getNextRow(s);n!==-1&&(this.board[n][s]=this.PLAYER2,this.countThreats(n,s,this.PLAYER2)>0&&i++,this.board[n][s]=this.EMPTY,this.board[n][s]=this.PLAYER1,this.countThreats(n,s,this.PLAYER1)>0&&t++,this.board[n][s]=this.EMPTY)}return i>=2&&(e+=1e3*i),t>=2&&(e-=800*t),e}countThreats(e,i,t){let s=0;const n=[[0,1],[1,0],[1,1],[1,-1]];for(const[a,c]of n){let r=1,h=0;for(let l=1;l<4;l++){const m=e+a*l,u=i+c*l;if(m<0||m>=this.ROWS||u<0||u>=this.COLS)break;if(this.board[m][u]===t)r++;else if(this.board[m][u]===this.EMPTY){h++;break}else break}for(let l=1;l<4;l++){const m=e-a*l,u=i-c*l;if(m<0||m>=this.ROWS||u<0||u>=this.COLS)break;if(this.board[m][u]===t)r++;else if(this.board[m][u]===this.EMPTY){h++;break}else break}r>=3&&h>0&&s++}return s}evaluateWindowAdvanced(e){let i=0;const t=e.filter(a=>a===this.PLAYER2).length,s=e.filter(a=>a===this.PLAYER1).length,n=e.filter(a=>a===this.EMPTY).length;return t>0&&s>0?0:t===4?1e6:(t===3&&n===1&&(i+=1e3),t===2&&n===2&&(i+=100),t===1&&n===3&&(i+=10),s===4?-1e6:(s===3&&n===1&&(i-=1e4),s===2&&n===2&&(i-=500),s===1&&n===3&&(i-=50),i))}getBoardKey(){let e="";for(let i=0;i<this.ROWS;i++)for(let t=0;t<this.COLS;t++)e+=this.board[i][t].toString();return e}showWinner(e){this.endGame(e)}}export{P as default};
